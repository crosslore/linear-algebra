%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The following line fixes a bug that was present in TeXLive 2017 an
% is fixed in TeXLive 2018 (verify this). It only affected latex, not
% pdflatex.
\pdfpageheight=\paperheight

%%% Background image
\ifthenelse{\equal{\detokenize{print-cover}}{\jobname}}{
  \backgroundsetup{
    scale=1,
    angle=0,
    opacity=1,
    position=current page.north west,
    nodeanchor=north west,
    contents={%
      \includegraphics[height=\paperheight,width=\trimwidth+\bleed]{figures/titlepage-image-print2}%
      \textcolor{spinecolour}{\rule{\spinewidth}{\paperheight}}%
      \includegraphics[height=\paperheight,width=\trimwidth+\bleed]{figures/titlepage-image-print1}%
    }%
  }
}{
  \backgroundsetup{
    scale=1,
    angle=0,
    opacity=1,
    contents={\includegraphics[width=\paperwidth,height=\paperheight]{figures/titlepage-image}}
  }
}  
\BgThispage

%% No page number
\thispagestyle{empty}

%% Title Information
%% Fix spacing on print-cover
\ifthenelse{\equal{\detokenize{print-cover}}{\jobname}}{
  \vspace{1.5em}
}{
  \vspace{7em}
}

\begin{center}
  \textbf{
    \fontsize{34}{36}\selectfont {\textcolor{subtitletextcolour}{\booksubtitle}} \\
    \fontsize{54}{60}\selectfont {\textcolor{titletextcolour}{\booksubject}} \\[.5\baselineskip]
    \fontsize{20pt}{22pt}\selectfont {\textcolor{subtitletextcolour}{An open text by Peter Selinger}}\smallskip\\
    \fontsize{14pt}{18pt}\selectfont {\textcolor{subtitletextcolour}{Based on the original text by Lyryx Learning and Ken Kuttler}}\bigskip \\[.5\baselineskip]
    \fontsize{14pt}{16pt}\selectfont {\textcolor{subtitletextcolour}{\edition}} \\
  }
\end{center}

\vfill

% License
\begin{center*}
  \ifthenelse{\equal{\detokenize{print-cover}}{\jobname}}{
    \raisebox{-0.5in}[0in][0in]{%
      \fontsize{12pt}{12pt}\selectfont \textcolor{cctextcolour}{\textbf{Creative Commons License (CC BY)}}%
    }
  }{
    \fontsize{12pt}{12pt}\selectfont \textcolor{cctextcolour}{\textbf{Creative Commons License (CC BY)}}%
  }
\end{center*}

\ifthenelse{\equal{\detokenize{print-cover}}{\jobname}}{
  \begin{tikzpicture}[remember picture,overlay]
    \node[outer sep=0in, inner sep=0in, anchor=north] at
    ([yshift=-\bleed-1in,xshift=\bleed+0.5\trimwidth]current page.north west) {
      \begin{minipage}{5.2in}
        \setlength{\parskip}{2ex}
        \fontsize{12pt}{16pt}\selectfont
        \textbf{\textsf{
          \textcolor{subtitletextcolour}{
            \input{frontmatter/blurb.tex}
          }
        }}
      \end{minipage}
    };
  \end{tikzpicture}
  \begin{tikzpicture}[remember picture,overlay]
    \node[outer sep=0in, inner sep=0in, anchor=center] at
    ([yshift=-\bleed-0.5\trimheight,xshift=\bleed+\trimwidth+0.5\spinewidth]current page.north west) {
      \rotatebox{-90}{%
        \begin{minipage}{\trimheight - 1in}
          \begin{tikzpicture}
            \node[anchor=west] at (0in,0) {
              \fontsize{26}{28}\selectfont {\textcolor{subtitletextcolour}{\textbf{\textsf{\bookfulltitle}}}}
            };
            \node[anchor=east] at (\trimheight - 1in,0) {
              \fontsize{20pt}{22pt}\selectfont {\textcolor{subtitletextcolour}{\textsf{Peter Selinger}}}
            };
          \end{tikzpicture}
        \end{minipage}
      }
    };
  \end{tikzpicture}
}{
  % No back cover for regular pdf
}

